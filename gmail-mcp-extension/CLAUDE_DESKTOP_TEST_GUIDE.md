# Claude Desktop Gmail MCP Bridge 测试指南

## 📋 测试前准备

1. **确保Bridge Server运行**
   ```bash
   cd mcp-server
   npm start
   ```

2. **确保Chrome扩展已加载**
   - 打开Chrome扩展管理页面
   - 确认Gmail MCP Bridge显示"Connected"

3. **打开Gmail标签页**
   - 至少打开2个Gmail账号
   - 建议一个账号打开多个标签页测试重复账号处理

## 🧪 测试场景

### 场景1：账号管理测试

#### 1.1 列出所有Gmail账号
**Claude Desktop输入：**
```
请列出所有可用的Gmail账号
```

**期望结果：**
- 显示所有打开的Gmail账号列表
- 显示每个账号的邮箱地址
- 标识当前活动账号

#### 1.2 切换账号
**Claude Desktop输入：**
```
请切换到 [你的邮箱地址] 账号
```

**期望结果：**
- 成功切换到指定账号
- 确认切换成功消息

#### 1.3 获取当前活动账号
**Claude Desktop输入：**
```
当前使用的是哪个Gmail账号？
```

**期望结果：**
- 显示当前活动账号的邮箱地址

---

### 场景2：邮件列表测试

#### 2.1 获取邮件列表（默认账号）
**Claude Desktop输入：**
```
显示我的邮件列表
```

**期望结果：**
- 显示邮件列表（最多50封）
- 包含主题、发件人、日期

#### 2.2 获取特定账号的邮件
**Claude Desktop输入：**
```
请使用 [邮箱地址] 账号显示邮件列表
```

**期望结果：**
- 显示指定账号的邮件列表
- 正确处理重复账号情况

#### 2.3 测试空收件箱
**Claude Desktop输入：**
```
显示邮件列表
```
（在一个空收件箱账号上测试）

**期望结果：**
- 提示收件箱为空
- 不报错

---

### 场景3：邮件操作测试

#### 3.1 读取邮件内容
**Claude Desktop输入：**
```
请读取第一封邮件的内容
```

**期望结果：**
- 显示邮件主题
- 显示发件人
- 显示邮件正文
- 显示日期

#### 3.2 搜索邮件
**Claude Desktop输入：**
```
搜索包含"重要"的邮件
```

**期望结果：**
- 返回包含关键词的邮件列表
- 显示匹配数量

#### 3.3 高级搜索
**Claude Desktop输入：**
```
搜索最近7天内来自 example@gmail.com 的邮件
```

**期望结果：**
- 返回符合条件的邮件
- 正确应用时间和发件人过滤

---

### 场景4：邮件发送测试

#### 4.1 撰写新邮件
**Claude Desktop输入：**
```
请帮我写一封邮件给 test@example.com，主题是"测试邮件"，内容是"这是一封测试邮件"
```

**期望结果：**
- 打开Gmail撰写窗口
- 自动填入收件人、主题和内容
- 提示撰写窗口已打开

#### 4.2 使用特定账号发送
**Claude Desktop输入：**
```
使用 [邮箱地址] 账号发送邮件给 test@example.com，主题"账号测试"
```

**期望结果：**
- 切换到指定账号
- 打开撰写窗口
- 正确填入信息

#### 4.3 回复邮件
**Claude Desktop输入：**
```
回复第一封邮件，内容是"收到，谢谢！"
```

**期望结果：**
- 打开回复窗口
- 自动填入回复内容

---

### 场景5：批量操作测试

#### 5.1 标记邮件为已读
**Claude Desktop输入：**
```
将前3封邮件标记为已读
```

**期望结果：**
- 成功标记指定邮件
- 返回操作结果

#### 5.2 删除邮件
**Claude Desktop输入：**
```
删除最旧的2封邮件
```

**期望结果：**
- 邮件移至垃圾箱
- 确认删除成功

#### 5.3 归档邮件
**Claude Desktop输入：**
```
归档所有已读邮件
```

**期望结果：**
- 已读邮件被归档
- 返回归档数量

---

### 场景6：边缘情况测试

#### 6.1 撰写窗口打开时获取邮件
**测试步骤：**
1. 打开Gmail撰写窗口
2. **Claude Desktop输入：**
   ```
   显示邮件列表
   ```

**期望结果：**
- 即使撰写窗口打开，仍能获取邮件列表
- 正确显示邮件数量

#### 6.2 多标签页同一账号
**测试步骤：**
1. 同一Gmail账号打开多个标签页
2. **Claude Desktop输入：**
   ```
   列出所有Gmail账号
   使用 [重复的邮箱] 显示邮件
   ```

**期望结果：**
- 正确识别重复账号
- 智能选择最合适的标签页

#### 6.3 账号切换后操作
**Claude Desktop输入：**
```
切换到 [账号A]
显示邮件列表
切换到 [账号B]
搜索"会议"
```

**期望结果：**
- 每次操作都在正确的账号上执行
- 账号切换不影响后续操作

---

### 场景7：错误处理测试

#### 7.1 无Gmail标签页
**测试步骤：**
1. 关闭所有Gmail标签页
2. **Claude Desktop输入：**
   ```
   显示邮件列表
   ```

**期望结果：**
- 友好的错误提示
- 建议打开Gmail

#### 7.2 无效账号切换
**Claude Desktop输入：**
```
切换到 notexist@gmail.com
```

**期望结果：**
- 提示账号不存在
- 显示可用账号列表

#### 7.3 网络断开恢复
**测试步骤：**
1. 断开网络
2. 尝试操作
3. 恢复网络
4. 重试操作

**期望结果：**
- 断网时给出合理错误
- 恢复后正常工作

---

## 📊 测试检查清单

### 基础功能
- [ ] 账号检测正常
- [ ] 账号切换成功
- [ ] 邮件列表显示正确数量
- [ ] 邮件内容读取完整
- [ ] 搜索功能正常
- [ ] 发送邮件窗口打开

### 高级功能
- [ ] 批量标记已读
- [ ] 批量删除
- [ ] 批量归档
- [ ] 多账号切换流畅
- [ ] 重复账号处理正确

### 边缘情况
- [ ] 撰写窗口不影响邮件列表
- [ ] 空收件箱正确处理
- [ ] 多标签页同账号正常
- [ ] 错误提示友好

---

## 🎯 常用测试命令示例

```
# 账号管理
"列出所有Gmail账号"
"切换到 cafferychen7850@gmail.com"
"当前是哪个账号？"

# 邮件查看
"显示最新的10封邮件"
"读取第一封邮件"
"显示 cafferychen777@tamu.edu 的邮件"

# 邮件搜索
"搜索关于会议的邮件"
"查找本周的邮件"
"搜索来自 noreply 的邮件"

# 邮件操作
"写邮件给 test@example.com，主题：测试"
"回复最新的邮件说：已收到"
"将前5封邮件标记为已读"
"删除垃圾邮件"
"归档所有已读邮件"
```

---

## ⚠️ 注意事项

1. **首次使用**：确保Bridge Server和Chrome扩展都已启动
2. **账号权限**：某些操作需要Gmail账号的相应权限
3. **响应时间**：复杂操作可能需要几秒钟
4. **刷新页面**：如果遇到问题，刷新Gmail页面并重试
5. **撰写窗口**：如果有未完成的草稿，保存或关闭后再测试

---

## 🐛 问题排查

### 如果遇到"Chrome extension not connected"
1. 检查Chrome扩展是否显示"Connected"
2. 重新加载Chrome扩展
3. 刷新Gmail页面

### 如果邮件数量显示为0但实际有邮件
1. 检查是否在收件箱视图
2. 关闭撰写窗口
3. 刷新页面后重试

### 如果账号切换失败
1. 确认账号邮箱地址拼写正确
2. 检查该账号的标签页是否还打开
3. 使用 `列出所有Gmail账号` 查看可用账号

---

## 📈 性能基准

正常情况下的响应时间：
- 账号列表：< 1秒
- 邮件列表：1-3秒
- 邮件搜索：2-5秒
- 邮件发送：1-2秒
- 批量操作：3-10秒（取决于数量）

如果响应时间明显超过以上范围，可能需要检查网络或系统状态。